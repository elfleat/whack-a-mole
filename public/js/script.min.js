"use strict";function getRandom(e,t){return Math.floor(Math.random()*(t-e))+e}var Library={Scoreboard:function(){var i="whack-a-moleScores",e={elfleat:48,jvaldes:16,mvanhouten:8,spierre:21};return this.init=function(){return this.get()||localStorage.setItem(i,JSON.stringify(e)),this},this.get=function(){return JSON.parse(localStorage.getItem(i))},this.saveScore=function(e,t){var s=this.get();return s[e]=t,localStorage.setItem(i,JSON.stringify(s)),!0},this.init()},Timer:function(e,t,s,i){var r=this.totalTime=s;return this.queryElements=function(){return this.el=e,this},this.startTimer=function(){this.timerInstance=setInterval(function(){i(r),r-=1,this.updateTimer(),0===r&&(this.stopTimer(),t())}.bind(this),1e3)}.bind(this),this.stopTimer=function(){clearInterval(this.timerInstance)},this.updateTimer=function(){return this.el.innerText=r,this},this.resetTimer=function(){return this.stopTimer(),r=this.totalTime,this},this.queryElements().updateTimer()},Modal:function(t){return this.queryElements=function(){var e=document.getElementById(t.container);return this.els={container:e,closeBtn:e.querySelector(".modal-close"),trigger:document.getElementById(t.trigger),overlay:document.querySelector(".modal-overlay")},this},this.bindEvents=function(){return this.els.closeBtn.addEventListener("click",this.close.bind(this)),this.els.overlay.addEventListener("click",this.close.bind(this)),this.els.trigger.addEventListener("click",this.open.bind(this)),this},this.open=function(){return this.render&&this.render(this.els),this.els.container.classList.add("is-open"),this.els.container.setAttribute("aria-modal",!0),this}.bind(this),this.close=function(){return this.els.container.classList.remove("is-open"),this.els.container.setAttribute("aria-modal",!1),this},this.queryElements().bindEvents()},GameApp:function(t){this.modules={},this.appState={totalGameTime:30,screen:"intro",score:0};var s=function(e){return this.appState.screen&&this.els.body.classList.remove("app-state-"+this.appState.screen),this.appState.screen=e,this.els.body.classList.add("app-state-"+this.appState.screen),this}.bind(this);return this.queryElements=function(){var e=document.getElementById(t.appContainer);return this.els={body:document.body,appContainer:e,leaderboardModalContainer:e.querySelector("#"+t.leaderboard),playNowBtn:e.querySelector("#"+t.playNowBtn),timerSeconds:e.querySelector("#"+t.timerSeconds),scorePoints:e.querySelector("#"+t.scorePoints),gameViewport:e.querySelector("#"+t.gameViewport),craters:document.querySelectorAll("."+t.craters),saveNameBtn:e.querySelector("#"+t.saveNameBtn),nameInput:e.querySelector("#"+t.nameInput),gameOverScore:e.querySelector("#"+t.gameOverScore),resetBtn:e.querySelector("#"+t.resetBtn),stopBtn:e.querySelector("#"+t.stopBtn)},this},this.bindEvents=function(){return this.els.playNowBtn.addEventListener("click",this.startGame.bind(this)),this.els.resetBtn.addEventListener("click",this.resetGame.bind(this)),this.els.stopBtn.addEventListener("click",this.stopGame.bind(this)),this.els.gameViewport.addEventListener("click",function(e){e.target.classList.contains("is-out")&&(this.addPoints(),e.target.classList.remove("is-out"))}.bind(this)),this.els.gameViewport.addEventListener("mousedown",function(e){if(e.target.classList.contains("game-mole"))return e.preventDefault()}.bind(this)),this.els.saveNameBtn.addEventListener("click",function(e){e.preventDefault();var t=this.els.nameInput.value;if(!t.length)return alert("Please enter your name.");s("intro"),this.modules.scoreBoard.saveScore(t,this.appState.score),this.appState.score=0,this.modules.leaderboardModal.open()}.bind(this)),this},this.initApp=function(){return s("intro"),this.modules.scoreBoard=Library.Scoreboard(),this.modules.leaderboardModal=new window.Library.Modal({container:"leaderboard-modal",trigger:"wam-leaderboard-cta",leaderboard:"leaderboard-modal"},this.modules.scoreBoard),this.modules.leaderboardModal.render=this.renderLeaderBoard.bind(this),this.modules.timer=new Library.Timer(this.els.timerSeconds,this.endGame.bind(this),this.appState.totalGameTime,this.checkForMoles.bind(this)),this},this.renderLeaderBoard=function(e){var i=this.modules.scoreBoard.get(),r="";Object.keys(i).forEach(function(e){var t,s;r+=(s=i[t=e],'<li class="leaderboard-item"><span class="leaderboard-item-user">'+t+'</span><span class="leaderboard-item-points">'+s+"</span></li>")}),e.container.querySelector(".leaderboard-table").innerHTML=r},this.addPoints=function(){return this.appState.score+=4,this.els.scorePoints.innerText=this.appState.score,this},this.resetPoints=function(){return this.appState.score=0,this.els.scorePoints.innerText=this.appState.score,this},this.showMole=function(e){e.classList.add("is-out")},this.hideMole=function(e){e.classList.remove("is-out")},this.resetGame=function(){this.stopGame().resetPoints().startGame()},this.stopGame=function(){return this.modules.timer.stopTimer(),this},this.checkForMoles=function(t){this.moleQueue.forEach(function(e){e.intro===t&&this.showMole(e.crater),e.outro===t&&this.hideMole(e.crater)}.bind(this))},this.startGame=function(){var e=0;for(this.moleQueue=[],s("game");e<20;){var t=getRandom(0,this.appState.totalGameTime);this.moleQueue.push({intro:t,outro:t-getRandom(1,5),crater:this.els.craters[getRandom(0,this.els.craters.length)]}),e++}return this.modules.timer.resetTimer().startTimer(),this},this.endGame=function(){this.els.gameOverScore.innerText=this.appState.score,this.resetPoints(),s("game-over")},this.queryElements().bindEvents().initApp()}};window.Library=Library,console.info("Welcome to Whack-a-Mole."),window.app=new Library.GameApp({appContainer:"wam-app",playNowBtn:"wam-play-cta",timerSeconds:"game-countdown-secs",scorePoints:"game-score-points",gameViewport:"game-screen",craters:"game-mole",saveNameBtn:"save-name-cta",nameInput:"game-over-name",gameOverScore:"game-over-score",resetBtn:"game-refresh-button",stopBtn:"game-stop-button"});
